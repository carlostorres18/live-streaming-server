<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Live Stream</title>
  </head>
  <body>
    <h2>Live Stream</h2>
    <video id="video" width="800" controls></video>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
      const MANIFEST_URL = `${window.location.origin}/hls/carlostorres18.m3u8`;
      const video = document.getElementById("video");
      let hlsInstance;

      function attachStream() {
        if (hlsInstance) {
          hlsInstance.destroy();
        }

        if (Hls.isSupported()) {
          hlsInstance = new Hls({
            manifestLoadingRetryDelay: 5000,
            manifestLoadingMaxRetry: Infinity,
          });
          hlsInstance.loadSource(MANIFEST_URL);
          hlsInstance.attachMedia(video);

          hlsInstance.on(Hls.Events.MEDIA_ATTACHED, function () {
            video.play().catch(function () {
              /* autoplay might be blocked; user interaction will start playback */
            });
          });

          hlsInstance.on(Hls.Events.ERROR, function (event, data) {
            if (!data.fatal) {
              return;
            }

            if (data.type === Hls.ErrorTypes.NETWORK_ERROR) {
              hlsInstance.startLoad();
            } else if (data.type === Hls.ErrorTypes.MEDIA_ERROR) {
              hlsInstance.recoverMediaError();
            } else {
              setTimeout(attachStream, 3000);
            }
          });
        } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
          video.src = MANIFEST_URL;
        }
      }

      video.addEventListener("stalled", function () {
        if (hlsInstance) {
          hlsInstance.startLoad();
        }
      });

      attachStream();
    </script>
  </body>
</html>
